import datetime
import json
from flask import Flask, render_template, request

from forms import NewTest
from config import Config
from sbt_test import SampleBallotTest

# create flask app and configure database and secret key
app = Flask(__name__)
app.config.from_object(Config)

@app.route('/', methods=['GET', 'POST'])
def sbt():
    form = NewTest()

    # fill in form values if user clicked rerun test on results page
    if request.query_string:
        form.district_id.data = request.args.get('district_id') 
        form.election_date.data = request.args.get('election_date')
        form.number_of_points.data = request.args.get('number_of_points')

    # if request is POST and form has no errors, run test and return results
    if form.validate_on_submit():
        district_id = request.form['district_id']
        election_date = request.form['election_date']
        number_of_points = request.form['number_of_points']

        test = SampleBallotTest(district_id, election_date, number_of_points, app.config)
        results = test.run()

        if results == None:
            results = {
                'error': 'No results from test'
            }
        else:
            results['district_id'] = district_id
            results['election_date'] = election_date
            results['number_of_points'] = number_of_points

        return render_template("results.html", title=" - Results", results=results) 

    # will also print form errors if there are any
    else:
        return render_template("sbt.html", title="", legend="New Test", form=form)

@app.route('/test', methods=['GET'])
def test():
    random_points = [
        ('-94.4865758551369', '39.3600653679374'), 
        ('-94.3544366394788', '39.2905498458398')
    ]
    random_points_json = json.dumps(random_points)
    print(random_points_json)

    results = {
        'random_points': random_points_json,
        'district_boundary': '{"type":"Polygon","coordinates":[[[-94.48404212842,39.14496743222],[-94.48195516542,39.14657360522],[-94.47721722642,39.15023018922],[-94.47712441242,39.15064099822],[-94.47715441242,39.15068699822],[-94.47716641242,39.15072199822],[-94.47721041242,39.15079599822],[-94.47723741242,39.15087399822],[-94.47724441242,39.15091399822],[-94.47725041242,39.15134999822],[-94.47724941242,39.15186799822],[-94.47724841242,39.15198399822],[-94.47724747942,39.15244890622],[-94.47724441242,39.15397599822],[-94.47724341242,39.15427099822],[-94.47723641242,39.15431299822],[-94.47723541242,39.15435499822],[-94.47724041242,39.15439699922],[-94.47723441242,39.15498899922],[-94.47723741342,39.15676999922],[-94.47722141342,39.15690199922],[-94.47722141342,39.15695699922],[-94.47603441242,39.15719999922],[-94.47567065342,39.15727129122],[-94.47566441242,39.15766199922],[-94.47561502542,39.16064863722],[-94.47558341342,39.16218000022],[-94.47551398942,39.17093280222],[-94.47560241442,39.17314400222],[-94.47544403842,39.17324174622],[-94.47545341342,39.17343798122],[-94.47534465342,39.18064480522],[-94.47525887842,39.19106380422],[-94.47527352742,39.19478761122],[-94.47377936042,39.19481031722],[-94.47484841642,39.19736600622],[-94.47539441642,39.19841600622],[-94.47559641642,39.19862600622],[-94.47562541642,39.19881200622],[-94.47542741642,39.19895200622],[-94.47534041642,39.19902200622],[-94.47523141642,39.19914200622],[-94.47512841642,39.19923000622],[-94.47518014142,39.19993022822],[-94.47509265642,39.20623246922],[-94.47581866942,39.20555366322],[-94.47622067742,39.20553971522],[-94.47635867942,39.20560945622],[-94.47662868442,39.20624176822],[-94.47736069742,39.20685547822],[-94.47791270742,39.20708329322],[-94.47836871542,39.20704145022],[-94.47862671942,39.20697635922],[-94.47902872742,39.20719487622],[-94.47980750042,39.20768424822],[-94.47986241842,39.20766400722],[-94.47997441842,39.20761100722],[-94.48029041842,39.20748300722],[-94.48058941842,39.20736100722],[-94.48132241842,39.20705300722],[-94.48322541942,39.20631600722],[-94.48368034442,39.20613504022],[-94.48422341942,39.20591900722],[-94.48423124642,39.20820538022],[-94.48423241942,39.20854800722],[-94.48420923342,39.20910199622],[-94.48473658642,39.20983977222],[-94.48529323742,39.20987382322],[-94.48589383342,39.20963546622],[-94.48642118742,39.20929495422],[-94.48674345842,39.20917009922],[-94.48822297642,39.20921550122],[-94.48822297642,39.20938575722],[-94.48927768342,39.21001002722],[-94.48996617242,39.20921550122],[-94.49332072442,39.20926090322],[-94.49333537242,39.21161040322],[-94.49329142642,39.21174660322],[-94.49326342242,39.21324800822],[-94.49322242342,39.21656100822],[-94.49337242342,39.21656000822],[-94.49343942342,39.21656000822],[-94.49376042342,39.21655900822],[-94.49556942342,39.21658000822],[-94.49603742342,39.21658300822],[-94.49642569942,39.21658480222],[-94.49682137442,39.21658663022],[-94.49906742442,39.21659700822],[-94.50000242442,39.21659500822],[-94.50165586742,39.21659358022],[-94.50231842542,39.21659300822],[-94.50521642642,39.21660100722],[-94.50697329642,39.21660180022],[-94.50743342642,39.21660200722],[-94.50863342742,39.21660300722],[-94.51103742742,39.21663300722],[-94.51122842742,39.21660200722],[-94.51143542742,39.21653500722],[-94.51171742842,39.21635800722],[-94.51198442842,39.21610700722],[-94.51221342842,39.21592400722],[-94.51264842842,39.21555700722],[-94.51268242842,39.21552800722],[-94.51307242842,39.21524400722],[-94.51342542842,39.21499700722],[-94.51374042842,39.21478400722],[-94.51414742842,39.21451900722],[-94.51426742842,39.21445000722],[-94.51430742842,39.21443100622],[-94.51447342842,39.21435200622],[-94.51461842842,39.21429600622],[-94.51476742842,39.21424900622],[-94.51499842842,39.21419200622],[-94.51570842842,39.21407000622],[-94.51641642942,39.21394900622],[-94.51666842942,39.21391900622],[-94.51692042942,39.21389600622],[-94.51729942942,39.21387500622],[-94.51741042942,39.21388600622],[-94.51751342942,39.21388600622],[-94.51768742942,39.21389900622],[-94.51781042942,39.21388900622],[-94.51792342942,39.21388900622],[-94.51806042942,39.21387900622],[-94.51818742942,39.21388500622],[-94.51929942942,39.21390900622],[-94.51985042942,39.21391500622],[-94.52003843042,39.21392500622],[-94.52066543042,39.21391900622],[-94.52095943042,39.21394400622],[-94.52107743042,39.21395100622],[-94.52128243042,39.21397500622],[-94.52375169942,39.21422470722],[-94.52386343142,39.21423600622],[-94.52555343142,39.21440800622],[-94.52632543142,39.21446300622],[-94.52658243142,39.21444300622],[-94.52672343142,39.21441100622],[-94.52715143142,39.21426400622],[-94.52778543242,39.21398800622],[-94.52961443242,39.21313000522],[-94.52984443242,39.21300600522],[-94.52989143242,39.21297600522],[-94.52997443242,39.21290900522],[-94.53008843242,39.21274400522],[-94.53026474242,39.21273404922],[-94.53022079642,39.21435706222],[-94.53022079642,39.21688797822],[-94.53014743342,39.22398400722],[-94.53005966042,39.22718094722],[-94.52999743442,39.23121200822],[-94.53003484142,39.23124913122],[-94.52999813542,39.23354753322],[-94.53092627742,39.23357658022],[-94.53090752742,39.23347491622],[-94.53161943542,39.23365300922],[-94.53170943542,39.23356400922],[-94.53178643542,39.23353100922],[-94.53193443542,39.23347600922],[-94.53211643542,39.23344900922],[-94.53272543542,39.23345700922],[-94.53378443542,39.23347100922],[-94.53404788742,39.23347457822],[-94.53459643542,39.23348200922],[-94.53989243742,39.23370200822],[-94.54032582042,39.23369073522],[-94.54255185942,39.23367679322],[-94.54256386042,39.23386734122],[-94.54245585842,39.23401606122],[-94.54244385742,39.23432279522],[-94.54236585642,39.23463417522],[-94.54214985242,39.23499202822],[-94.54208385142,39.23529875822],[-94.54262386142,39.23580532522],[-94.54314143842,39.23612000822],[-94.54356587742,39.23653960722],[-94.54402188642,39.23699969122],[-94.54425589042,39.23709263722],[-94.54442389342,39.23720417222],[-94.54453789542,39.23743653622],[-94.54439989242,39.23755271722],[-94.54390788342,39.23772466622],[-94.54391988442,39.23785478922],[-94.54415388842,39.23791520322],[-94.54419588942,39.23803138422],[-94.54425589042,39.23824515622],[-94.54494590242,39.23916065222],[-94.54514390642,39.23935583222],[-94.54585791842,39.23949059922],[-94.54620592442,39.23941159822],[-94.54679393542,39.23923035922],[-94.54727394442,39.23921641822],[-94.54754394842,39.23927218422],[-94.54780795342,39.23944412822],[-94.54787395442,39.23976013322],[-94.54801795742,39.23991813422],[-94.54837796342,39.24000642922],[-94.54882197142,39.24036425522],[-94.54915797742,39.24052225622],[-94.54936798142,39.24063378522],[-94.54973998742,39.24064307922],[-94.55033999842,39.24114496022],[-94.55064600442,39.24120537122],[-94.55076000642,39.24126578222],[-94.55098801042,39.24134942922],[-94.55140801742,39.24136337022],[-94.55171402342,39.24149813322],[-94.55205602942,39.24155854422],[-94.55235003442,39.24177230622],[-94.55235603442,39.24207435922],[-94.55230803342,39.24228347222],[-94.55230803342,39.24301303922],[-94.55225403242,39.24316638722],[-94.55238603542,39.24331044022],[-94.55242803542,39.24351490322],[-94.55207402942,39.24355207822],[-94.55193602742,39.24374724622],[-94.55229603342,39.24415152122],[-94.55254203742,39.24469055122],[-94.55267356042,39.24525373922],[-94.55261979942,39.24571469622],[-94.55288476442,39.24631542222],[-94.55313436842,39.24661280922],[-94.55342621342,39.24660983522],[-94.55342621342,39.24641653322],[-94.55384094142,39.24632434322],[-94.55398686342,39.24626486622],[-94.55397534342,39.24605372022],[-94.55385630142,39.24589610422],[-94.55386014142,39.24567008722],[-94.55422110742,39.24558384422],[-94.55470111642,39.24562547922],[-94.55512736442,39.24573253922],[-94.55531168742,39.24591692122],[-94.55530016742,39.24644627222],[-94.55508128342,39.24660686122],[-94.55521952542,39.24678529322],[-94.55523872642,39.24697561922],[-94.55481631842,39.24717486722],[-94.55479327842,39.24727895122],[-94.55410974542,39.24756741322],[-94.55412510642,39.24781424022],[-94.55387550142,39.24797779922],[-94.55388121842,39.24802206922],[-94.55385170042,39.24802144822],[-94.55346944242,39.24806401022],[-94.55313544242,39.24809701022],[-94.55303544242,39.24810601022],[-94.55286344242,39.24812301022],[-94.55205165942,39.24820443522],[-94.55169244142,39.24823101022],[-94.55134944142,39.24823401022],[-94.55112744142,39.24822701022],[-94.55081444142,39.24820501022],[-94.55042644142,39.24817501022],[-94.55026044142,39.24816901022],[-94.55011944142,39.24817301022],[-94.54977444142,39.24820601022],[-94.54954944142,39.24826201022],[-94.54863044142,39.24857201022],[-94.54817120742,39.24872994822],[-94.54800244042,39.24879101022],[-94.54798844042,39.24914801022],[-94.54814799742,39.24924837722],[-94.54811026342,39.24954333422],[-94.54801344142,39.25220401122],[-94.54797144142,39.25544701122],[-94.54795322442,39.25631686622],[-94.54795744142,39.25649401222],[-94.54800044142,39.25656801222],[-94.54811644142,39.25661301222],[-94.54850444142,39.25665001222],[-94.54863444142,39.25670101222],[-94.54869844142,39.25677401222],[-94.54871344142,39.25685501222],[-94.54874221442,39.25923499422],[-94.54874414142,39.25939440822],[-94.54875244242,39.26008101222],[-94.54880044242,39.26017601222],[-94.54890844242,39.26024701222],[-94.55104567342,39.26029423522],[-94.55153344242,39.26030501222],[-94.55224344342,39.26033001222],[-94.55239444342,39.26035501222],[-94.55248344342,39.26040701222],[-94.55255144342,39.26047701222],[-94.55259444342,39.26057401222],[-94.55262444342,39.26071301222],[-94.55263844342,39.26095401222],[-94.55261547242,39.26200768522],[-94.55260899142,39.26230496622],[-94.55256944342,39.26411901322],[-94.55252882642,39.26713998722],[-94.55252322442,39.26756069322],[-94.55249744442,39.26956301422],[-94.55246887442,39.27169105622],[-94.55246664042,39.27185744022],[-94.55246444442,39.27202101422],[-94.55243102242,39.27458596522],[-94.55242944442,39.27470701422],[-94.54929044342,39.27468401522],[-94.54417544242,39.27464001522],[-94.54402044242,39.27463901522],[-94.54390844242,39.27463801522],[-94.54039961642,39.27460809922],[-94.53945144142,39.27460001522],[-94.53494643942,39.27455301522],[-94.53462243942,39.27457101522],[-94.53428243942,39.27464101522],[-94.53400243942,39.27477101622],[-94.53299443942,39.27532301622],[-94.53271343942,39.27546701622],[-94.53184543942,39.27568601622],[-94.53165843942,39.27575301622],[-94.53141143942,39.27584201622],[-94.53099243842,39.27601001622],[-94.53068032042,39.27611600922],[-94.53035343842,39.27622701622],[-94.53071443842,39.27679601622],[-94.53178443942,39.27835101622],[-94.53205243942,39.27867301622],[-94.53231043942,39.27894201622],[-94.53270243942,39.27936801622],[-94.53343043942,39.28017201622],[-94.53384644042,39.28063101722],[-94.53415644042,39.28094801722],[-94.53422944042,39.28101801722],[-94.53440544042,39.28112701722],[-94.53456844042,39.28117501722],[-94.53608444042,39.28156101722],[-94.53733344142,39.28200401722],[-94.53763341042,39.28208192622],[-94.53805344142,39.28219101722],[-94.53961544142,39.28289501722],[-94.53986844142,39.28297401722],[-94.54003544242,39.28299301722],[-94.54245544242,39.28300701622],[-94.54643195342,39.28303292722],[-94.54705944342,39.28303701622],[-94.54726444342,39.28307201622],[-94.54743444442,39.28315401622],[-94.54749644442,39.28321501622],[-94.54756944442,39.28328801622],[-94.54762444442,39.28340301622],[-94.54763844442,39.28348401622],[-94.54761944442,39.28589601722],[-94.54761192342,39.28663037722],[-94.54761744442,39.28704601722],[-94.54755128442,39.28776198422],[-94.54968883142,39.28847063922],[-94.54996144542,39.28856101722],[-94.54998844542,39.28857001722],[-94.55012744542,39.28861601722],[-94.55027544542,39.28866601722],[-94.55042544542,39.28871601722],[-94.55057544542,39.28876601722],[-94.55072644542,39.28881601722],[-94.55087644542,39.28886701722],[-94.55102544542,39.28891701722],[-94.55117344542,39.28896701722],[-94.55132144542,39.28901701722],[-94.55146744542,39.28906601722],[-94.55161244542,39.28911401722],[-94.55189344542,39.28920601722],[-94.55202644542,39.28925101722],[-94.55215344542,39.28929501722],[-94.55227844542,39.28933801722],[-94.55239944542,39.28937901722],[-94.55251844642,39.28942001722],[-94.55263744642,39.28945901722],[-94.55275744642,39.28949801722],[-94.55287544642,39.28953601722],[-94.55298844642,39.28957201722],[-94.55309244642,39.28960501722],[-94.55318644642,39.28963501722],[-94.55327044642,39.28966201722],[-94.55334544642,39.28968401722],[-94.55341344642,39.28970401722],[-94.55347844642,39.28972401722],[-94.55376644642,39.28982501722],[-94.55415544642,39.28991501722],[-94.55476444642,39.29002301722],[-94.55570844642,39.29005601722],[-94.55615244742,39.29003901722],[-94.55648744742,39.29005001722],[-94.55673829642,39.29009358922],[-94.55689044742,39.29012001722],[-94.55684644742,39.29551701822],[-94.55684244742,39.29598301822],[-94.55684026642,39.29619625722],[-94.55683705942,39.29653034222],[-94.56345810742,39.29659485722],[-94.56935738642,39.29661671722],[-94.57540212142,39.29662386822],[-94.57659891642,39.29663140522],[-94.57835524842,39.29665289822],[-94.57834587342,39.29654407022],[-94.57915145342,39.29659901722],[-94.57929245342,39.29670301722],[-94.57949882742,39.29686344722],[-94.58015945442,39.29649901622],[-94.58029845442,39.29661001722],[-94.58037245442,39.29665501722],[-94.58047145442,39.29669401722],[-94.58051845442,39.29670701722],[-94.58059545442,39.29671901722],[-94.58069445442,39.29674001722],[-94.58078245442,39.29673601622],[-94.58107945442,39.29670301622],[-94.58117545442,39.29669701622],[-94.58130445442,39.29668101622],[-94.58152745442,39.29667701622],[-94.58165530742,39.29667701622],[-94.58189245442,39.29667701622],[-94.58383945542,39.29670401622],[-94.58667047242,39.29672740622],[-94.59195045742,39.29680101622],[-94.59774855042,39.29683368422],[-94.60038473342,39.29685826422],[-94.60042300042,39.29852400022],[-94.60049300042,39.30238000122],[-94.60061400042,39.30707900022],[-94.60062100042,39.30739700022],[-94.60070800042,39.31090800022],[-94.60090200042,39.32561300022],[-94.60076200042,39.33330000022],[-94.60079000042,39.33611000022],[-94.60079600042,39.33666900022],[-94.60078900042,39.33991800022],[-94.60077100042,39.34722100022],[-94.60071400042,39.35437100022],[-94.60081000042,39.37097100022],[-94.60091100042,39.37607000022],[-94.60101600042,39.38372800022],[-94.60096200042,39.38675700122],[-94.60085500042,39.39454300022],[-94.60081200042,39.39782800122],[-94.60069900042,39.40517600022],[-94.60065700042,39.41722200022],[-94.60070400042,39.43387700022],[-94.60073200042,39.44367700122],[-94.60081900042,39.45615500022],[-94.59787900042,39.45583800022],[-94.57383700042,39.45584800022],[-94.56763800042,39.45587200022],[-94.56734200042,39.45588500022],[-94.56568400042,39.45588600022],[-94.56492500042,39.45585900022],[-94.56473300042,39.45588000022],[-94.56436000042,39.45601900022],[-94.55337200042,39.45581500022],[-94.55083000042,39.45580200022],[-94.51980000042,39.45558500022],[-94.51972500042,39.45565400022],[-94.48593100042,39.45554800022],[-94.48248400042,39.45554200022],[-94.47246800042,39.45552300022],[-94.46337200042,39.45542900022],[-94.43523600042,39.45540500022],[-94.43516400042,39.45570400022],[-94.37801600042,39.45552700022],[-94.37300300042,39.45556200022],[-94.37102300042,39.45561400022],[-94.35907900042,39.45553500022],[-94.35123400042,39.45557500022],[-94.34216800042,39.45556000022],[-94.32648000042,39.45560300022],[-94.32342000042,39.45562400022],[-94.32180600042,39.45559100022],[-94.30430800042,39.45554200022],[-94.28561200042,39.45533900022],[-94.27634000042,39.45528000022],[-94.25758400042,39.45520300022],[-94.21064200042,39.45468200022],[-94.21074200042,39.44555400022],[-94.21075800042,39.44401500022],[-94.21094000042,39.42986100022],[-94.21079400042,39.42568100022],[-94.21114000042,39.40724800022],[-94.21117300042,39.40453500022],[-94.21127400042,39.39641700022],[-94.21126600042,39.39485800022],[-94.21133100042,39.39323900022],[-94.21142500042,39.38937700022],[-94.21159000042,39.38580500022],[-94.21161700042,39.37819400022],[-94.21187100042,39.35162200022],[-94.21188800042,39.34976400022],[-94.21189200042,39.34953000022],[-94.21172600042,39.34376400022],[-94.21177200042,39.34039000022],[-94.21202400042,39.33067700022],[-94.21216100042,39.31651400022],[-94.21227300042,39.29460000022],[-94.21214400042,39.27323700022],[-94.21212900042,39.26545500022],[-94.21211200042,39.25438800022],[-94.21218800042,39.23433300022],[-94.21251500042,39.20708600022],[-94.21681600042,39.20800400022],[-94.21774400042,39.20845200022],[-94.22127500042,39.21013400022],[-94.22685500042,39.21338100022],[-94.22956100042,39.21535600022],[-94.23245300042,39.21844900022],[-94.23545600042,39.22442800022],[-94.23842900042,39.22821900022],[-94.24331100042,39.23200400022],[-94.25004600042,39.23484500022],[-94.25542400042,39.23621900022],[-94.26293800042,39.23582200022],[-94.26740000042,39.23539600022],[-94.27387000042,39.23572300022],[-94.27832500042,39.23615900022],[-94.28987300042,39.23710700022],[-94.29510500042,39.23552300022],[-94.30092900042,39.23339500022],[-94.30460900042,39.23141100022],[-94.30802800042,39.22786500022],[-94.30893200042,39.22735100022],[-94.31154300042,39.22357300022],[-94.31400200042,39.22126700022],[-94.31677000042,39.21573100022],[-94.31757000042,39.21345900022],[-94.31936200042,39.20461100022],[-94.32049800042,39.20176300022],[-94.32231700042,39.19864700022],[-94.32815500042,39.19123200022],[-94.33175200042,39.18708800022],[-94.33521300042,39.18333700022],[-94.33765900042,39.18074200022],[-94.34617200042,39.17388200022],[-94.35066400042,39.17142500022],[-94.35413200042,39.17045100022],[-94.35632200042,39.16900400022],[-94.35817900042,39.16746600022],[-94.36010000042,39.16576300022],[-94.36355600042,39.16365600022],[-94.36598000042,39.16322700022],[-94.36941500042,39.16367600022],[-94.37381100042,39.16695900022],[-94.37516500042,39.16809900022],[-94.37644700042,39.16885700022],[-94.37783900042,39.16978000022],[-94.37849400042,39.17036500022],[-94.38009800042,39.17345000022],[-94.38232000042,39.18045600022],[-94.38482800042,39.18720400022],[-94.38781700042,39.19105200022],[-94.38972800042,39.19350300022],[-94.39069400042,39.19401300022],[-94.39502800042,39.19630300022],[-94.40178200042,39.19700100022],[-94.40212800042,39.19700300022],[-94.40722800042,39.19530300022],[-94.40862800042,39.19360300022],[-94.40902500042,39.19210400022],[-94.40308500042,39.18198200022],[-94.40261900042,39.18120000022],[-94.40042600042,39.17598300022],[-94.39992800042,39.17480300022],[-94.40122800042,39.16790300022],[-94.40232800042,39.16476600022],[-94.40559300042,39.16259000022],[-94.41796300042,39.15114400022],[-94.41947500042,39.14931800022],[-94.42348500042,39.14406900022],[-94.43036500042,39.13802600022],[-94.43158100042,39.13736900022],[-94.44064200042,39.13078000022],[-94.44429200042,39.12900700022],[-94.45542900042,39.12310400022],[-94.46159000042,39.12037200022],[-94.46754600042,39.12478000022],[-94.46931800042,39.12883900022],[-94.46933000042,39.13070400022],[-94.47633000042,39.13700400022],[-94.48023000042,39.14140300022],[-94.48404212842,39.14496743222]]]}'
    }

    return render_template("test.html", title="- Sample Ballot Testing - Results", results=results)

if __name__ == '__main__':
    app.run(debug = True)
